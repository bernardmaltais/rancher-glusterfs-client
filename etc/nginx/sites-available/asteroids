map $http_upgrade $connection_upgrade {                                         
    default upgrade;                                                            
    '' close;                                                                   
}                                                                               
                                                                                
upstream nodejs {                                                            
    server localhost:82;                                                        
}                                                                               

server {
    listen 80;
    location / {
        root /mnt/gluster/asteroids/client/;
    }
}
                                                                                
server {                                                                        
    listen 81;                                                                  
    location / {                                                                
        proxy_pass http://nodejs;                                            
        proxy_http_version 1.1;                                                 
        proxy_set_header Upgrade $http_upgrade;                                 
        proxy_set_header Connection $connection_upgrade;                        
    }                                                                           
    location /index.html {                                                      
        root /mnt/gluster/asteroids/client/;                             
    }                                                                           
}
